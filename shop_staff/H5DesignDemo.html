<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>咖啡店点餐系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chosen Palette: Warm Neutral & Coffee -->
    <!-- Application Structure Plan: The application implements the proven three-column POS layout (Categories | Products | Cart) as specified in the source report. This structure is chosen for maximum operational efficiency in a fast-paced counter-service environment. It allows the cashier to see all critical information at once—what they can add, what they are adding, and the state of the current order—minimizing clicks and cognitive load. The user flow is linear and task-focused: select a category (left), tap a product (middle), see it appear in the cart (right), and finally, check out. A modal is used for product customization to handle complexity without navigating away from the main screen. This design directly translates the report's workflow into a functional, user-friendly interface. -->
    <!-- Visualization & Content Choices: Report Info: Categories List -> Goal: Fast product filtering -> Method: Vertical button list -> Interaction: Click filters product grid -> Justification: Persistent list is faster than menus. | Report Info: Product List -> Goal: Quick item identification -> Method: Visual grid cards (HTML/Tailwind) -> Interaction: Click adds to cart or opens customization modal -> Justification: Visuals are faster to scan. | Report Info: Order Details -> Goal: Real-time order summary -> Method: Structured list -> Interaction: Modify items directly in the list -> Justification: Crucial for accuracy. | Report Info: Customization Options -> Goal: Capture complex preferences -> Method: Modal dialog -> Interaction: Select options and confirm -> Justification: Focuses user on one task without losing context. All interactions are handled with vanilla JavaScript. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Inter', 'Noto Sans SC', sans-serif; }
        .category-btn.active { background-color: #a16207; color: white; }
        .modal-option-btn.selected { background-color: #a16207; color: white; border-color: #a16207; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-stone-100 text-stone-800 h-screen overflow-hidden flex flex-col">

    <div id="pos-app" class="flex flex-col h-full">
        
        <header class="bg-white shadow-md w-full flex-shrink-0">
            <div class="flex items-center justify-between p-3 px-6 h-16">
                <div class="flex items-center space-x-4">
                    <div class="text-2xl font-bold text-amber-800">Caffeine Corner</div>
                    <div class="hidden md:block text-sm text-stone-500 border-l pl-4">当前店员: <span class="font-medium">张三</span></div>
                </div>
                <div class="flex-1 max-w-lg mx-4">
                    <div class="relative">
                        <span class="absolute left-3 top-1/2 -translate-y-1/2 text-stone-400">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" /></svg>
                        </span>
                        <input type="text" id="search-bar" placeholder="搜索商品 (例如: '拿铁' 或 'nt')" class="bg-stone-100 border border-stone-200 rounded-full w-full py-2 pl-10 pr-4 focus:outline-none focus:ring-2 focus:ring-amber-500 transition">
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                     <div class="text-sm text-stone-500" id="current-time">--:--:--</div>
                    <span class="text-green-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8.111 16.555a5.5 5.5 0 017.778 0M12 20.25a2.25 2.25 0 100-4.5 2.25 2.25 0 000 4.5z" /><path d="M12 12.75a2.25 2.25 0 100-4.5 2.25 2.25 0 000 4.5zM12 5.25a2.25 2.25 0 100-4.5 2.25 2.25 0 000 4.5z" /></svg>
                    </span>
                    <span class="text-stone-400">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                    </span>
                </div>
            </div>
        </header>

        <main class="flex-1 grid grid-cols-10 gap-4 p-4 overflow-hidden">
            
            <aside class="col-span-2 bg-white rounded-lg shadow p-3 flex flex-col space-y-2 no-scrollbar overflow-y-auto">
                <div id="category-list"></div>
            </aside>

            <section id="product-grid-container" class="col-span-5 bg-white rounded-lg shadow p-4 overflow-y-auto no-scrollbar">
                <div id="product-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4"></div>
            </section>

            <section class="col-span-3 bg-white rounded-lg shadow flex flex-col p-4">
                <div class="flex items-center justify-between border-b pb-3 mb-3">
                     <div>
                        <span class="font-bold text-lg">订单号:</span>
                        <span id="order-id" class="text-lg text-amber-800 font-mono">#1024</span>
                    </div>
                    <div class="flex space-x-1 bg-stone-100 p-1 rounded-lg">
                        <button class="px-3 py-1 text-sm rounded-md bg-white shadow">堂食</button>
                        <button class="px-3 py-1 text-sm rounded-md text-stone-600">外带</button>
                    </div>
                </div>
                
                <div id="cart-items" class="flex-1 overflow-y-auto no-scrollbar pr-2">
                    <div class="text-center text-stone-400 py-16">
                        <p>购物车是空的</p>
                        <p class="text-sm mt-1">请从左侧选择商品</p>
                    </div>
                </div>
                
                <div class="mt-auto pt-4 border-t">
                    <div class="space-y-2 text-sm text-stone-600">
                        <div class="flex justify-between">
                            <span>小计</span>
                            <span id="subtotal" class="font-mono">¥ 0.00</span>
                        </div>
                        <div class="flex justify-between">
                            <span>折扣</span>
                            <span id="discount" class="font-mono">- ¥ 0.00</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center mt-3 pt-3 border-t">
                        <span class="text-xl font-bold">应付总额</span>
                        <span id="total" class="text-2xl font-bold text-amber-800 font-mono">¥ 0.00</span>
                    </div>
                    <div class="grid grid-cols-4 gap-2 mt-4">
                        <button class="bg-stone-200 text-stone-700 py-2 rounded-lg text-sm hover:bg-stone-300 transition">挂单</button>
                        <button class="bg-stone-200 text-stone-700 py-2 rounded-lg text-sm hover:bg-stone-300 transition">取单</button>
                        <button class="bg-stone-200 text-stone-700 py-2 rounded-lg text-sm hover:bg-stone-300 transition">折扣</button>
                        <button id="clear-cart-btn" class="bg-red-100 text-red-700 py-2 rounded-lg text-sm hover:bg-red-200 transition">清空</button>
                    </div>
                    <button id="checkout-btn" class="w-full bg-emerald-600 text-white font-bold py-4 mt-2 rounded-lg text-lg hover:bg-emerald-700 transition shadow-lg disabled:bg-stone-300 disabled:cursor-not-allowed">
                        结 账
                    </button>
                </div>
            </section>

        </main>
    </div>

    <div id="options-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-md m-4" id="modal-content">
        </div>
    </div>


    <script>
        const DB = {
            categories: [
                { id: 'fav', name: '⭐ 常用/热销' },
                { id: 'espresso', name: '☕️ 意式咖啡' },
                { id: 'dessert', name: '🍰 蛋糕甜品' },
                { id: 'light-meal', name: '🥪 轻食简餐' },
                { id: 'bakery', name: '🥐 面包烘焙' },
            ],
            products: [
                { id: 1, category: 'espresso', name: '拿铁', pinyin: 'natie', initial: 'nt', price: 32, img: 'https://placehold.co/200x200/a16207/white?text=Latte', options: [
                    { name: '规格', type: 'radio', items: [{ name: '中杯', price: 0 }, { name: '大杯', price: 3 }, { name: '特大杯', price: 6 }] },
                    { name: '温度', type: 'radio', items: [{ name: '热', price: 0 }, { name: '冰', price: 0 }, { name: '少冰', price: 0 }] },
                    { name: '奶底', type: 'radio', items: [{ name: '牛奶', price: 0 }, { name: '燕麦奶', price: 3 }, { name: '豆奶', price: 0 }] },
                    { name: '甜度', type: 'radio', items: [{ name: '标准', price: 0 }, { name: '半糖', price: 0 }, { name: '无糖', price: 0 }] },
                    { name: '附加项', type: 'checkbox', items: [{ name: '加一份浓缩', price: 5 }] }
                ]},
                { id: 2, category: 'espresso', name: '美式咖啡', pinyin: 'meishikafei', initial: 'mskf', price: 25, img: 'https://placehold.co/200x200/422006/white?text=Americano', options: [
                    { name: '规格', type: 'radio', items: [{ name: '中杯', price: 0 }, { name: '大杯', price: 3 }] },
                    { name: '温度', type: 'radio', items: [{ name: '热', price: 0 }, { name: '冰', price: 0 }] },
                ]},
                { id: 3, category: 'espresso', name: '卡布奇诺', pinyin: 'kabuqinuo', initial: 'kbqn', price: 32, img: 'https://placehold.co/200x200/c27803/white?text=Cappuccino', options: [
                    { name: '规格', type: 'radio', items: [{ name: '中杯', price: 0 }, { name: '大杯', price: 3 }] },
                    { name: '温度', type: 'radio', items: [{ name: '热', price: 0 }, { name: '冰', price: 0 }] },
                ]},
                { id: 4, category: 'dessert', name: '提拉米苏', pinyin: 'tilamisu', initial: 'tlms', price: 38, img: 'https://placehold.co/200x200/e9a200/white?text=Tiramisu' },
                { id: 5, category: 'dessert', name: '芝士蛋糕', pinyin: 'zhishidangao', initial: 'zsdg', price: 35, img: 'https://placehold.co/200x200/ffc900/white?text=Cheesecake' },
                { id: 6, category: 'light-meal', name: '鸡肉三明治', pinyin: 'jirousanmingzhi', initial: 'jrsms', price: 28, img: 'https://placehold.co/200x200/7a9002/white?text=Sandwich' },
                { id: 7, category: 'bakery', name: '可颂面包', pinyin: 'kesongmianbao', initial: 'ksmb', price: 18, img: 'https://placehold.co/200x200/e48900/white?text=Croissant' },
                { id: 8, category: 'bakery', name: '法棍', pinyin: 'fagun', initial: 'fg', price: 15, img: 'https://placehold.co/200x200/d59d00/white?text=Baguette' },
                { id: 9, category: 'espresso', name: '摩卡', pinyin: 'moka', initial: 'mk', price: 35, img: 'https://placehold.co/200x200/693c06/white?text=Mocha', options: [
                     { name: '规格', type: 'radio', items: [{ name: '中杯', price: 0 }, { name: '大杯', price: 3 }] },
                ]},
                 { id: 10, category: 'light-meal', name: '金枪鱼沙拉', pinyin: 'jinqiangyushala', initial: 'jqysl', price: 32, img: 'https://placehold.co/200x200/90a955/white?text=Salad' },
            ],
             favProductIds: [1, 4, 2, 7, 6],
        };

        const AppState = {
            currentCategory: 'fav',
            cart: [],
            orderIdCounter: 1024,
        };

        const a = (sel) => document.querySelector(sel);
        const b = (sel) => document.querySelectorAll(sel);
        const c = (tag) => document.createElement(tag);

        function renderCategories() {
            const list = a('#category-list');
            list.innerHTML = '';
            DB.categories.forEach(cat => {
                const btn = c('button');
                btn.className = `category-btn w-full text-left px-4 py-3 rounded-lg font-medium transition ${AppState.currentCategory === cat.id ? 'active' : 'hover:bg-amber-100'}`;
                btn.textContent = cat.name;
                btn.dataset.categoryId = cat.id;
                btn.onclick = () => selectCategory(cat.id);
                list.appendChild(btn);
            });
        }

        function renderProducts(filter = '') {
            const grid = a('#product-grid');
            grid.innerHTML = '';
            let productsToShow;

            if (filter) {
                const lowerFilter = filter.toLowerCase();
                productsToShow = DB.products.filter(p => 
                    p.name.includes(lowerFilter) || 
                    p.pinyin.includes(lowerFilter) ||
                    p.initial.includes(lowerFilter)
                );
            } else if (AppState.currentCategory === 'fav') {
                 productsToShow = DB.favProductIds.map(id => DB.products.find(p => p.id === id));
            } else {
                productsToShow = DB.products.filter(p => p.category === AppState.currentCategory);
            }

            productsToShow.forEach(product => {
                const card = c('div');
                card.className = 'border rounded-lg p-2 flex flex-col items-center justify-between text-center cursor-pointer hover:shadow-lg hover:border-amber-500 transition';
                card.onclick = () => handleProductClick(product);
                card.innerHTML = `
                    <img src="${product.img}" alt="${product.name}" class="w-full h-24 object-cover rounded-md mb-2">
                    <div class="flex-1 flex flex-col justify-center">
                        <p class="font-semibold text-sm">${product.name}</p>
                        <p class="text-xs text-stone-500">¥ ${product.price.toFixed(2)}</p>
                    </div>
                `;
                grid.appendChild(card);
            });
        }
        
        function selectCategory(categoryId) {
            AppState.currentCategory = categoryId;
            a('#search-bar').value = '';
            renderCategories();
            renderProducts();
        }

        function handleProductClick(product) {
            if (product.options) {
                showOptionsModal(product);
            } else {
                addToCart(product, []);
            }
        }
        
        function showOptionsModal(product, cartItem = null) {
            const modal = a('#options-modal');
            const modalContent = a('#modal-content');
            
            let selectedOptions = cartItem ? cartItem.options.reduce((acc, opt) => {
                if (!acc[opt.group]) acc[opt.group] = [];
                acc[opt.group].push(opt.name);
                return acc;
            }, {}) : {};

            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-start">
                        <h3 class="text-xl font-bold mb-4">${product.name}</h3>
                        <button id="close-modal-btn" class="text-stone-400 hover:text-stone-600">&times;</button>
                    </div>
                    <div class="space-y-4 max-h-[60vh] overflow-y-auto pr-2">
                        ${product.options.map(group => `
                            <div>
                                <p class="font-semibold mb-2">${group.name}</p>
                                <div class="flex flex-wrap gap-2">
                                    ${group.items.map(item => `
                                        <button data-group="${group.name}" data-item-name="${item.name}" data-price="${item.price}" data-type="${group.type}" class="modal-option-btn border px-3 py-2 text-sm rounded-lg hover:border-amber-600 transition ${isOptionSelected(selectedOptions, group.name, item.name) ? 'selected' : ''}">
                                            ${item.name} ${item.price > 0 ? `(+¥${item.price.toFixed(2)})` : ''}
                                        </button>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="bg-stone-50 p-4 flex justify-end space-x-2 rounded-b-lg">
                    <button id="cancel-modal-btn" class="px-6 py-2 rounded-lg bg-stone-200 hover:bg-stone-300 transition">取消</button>
                    <button id="confirm-options-btn" class="px-6 py-2 rounded-lg bg-amber-700 text-white hover:bg-amber-800 transition">确认添加</button>
                </div>
            `;

            modal.classList.remove('hidden');
            modal.classList.add('flex');
            
            function isOptionSelected(selections, groupName, itemName) {
                return selections[groupName] && selections[groupName].includes(itemName);
            }

            modalContent.addEventListener('click', e => {
                const target = e.target.closest('.modal-option-btn');
                if (!target) return;

                const { group, type, itemName } = target.dataset;
                
                if (type === 'radio') {
                    b(`.modal-option-btn[data-group="${group}"]`).forEach(btn => btn.classList.remove('selected'));
                    target.classList.add('selected');
                } else if (type === 'checkbox') {
                    target.classList.toggle('selected');
                }
            });

            a('#close-modal-btn').onclick = a('#cancel-modal-btn').onclick = () => modal.classList.add('hidden');
            
            a('#confirm-options-btn').onclick = () => {
                 const finalOptions = [];
                 b('.modal-option-btn.selected').forEach(btn => {
                    finalOptions.push({
                        group: btn.dataset.group,
                        name: btn.dataset.itemName,
                        price: parseFloat(btn.dataset.price)
                    });
                });
                if (cartItem) {
                    updateCartItem(cartItem.id, finalOptions);
                } else {
                    addToCart(product, finalOptions);
                }
                modal.classList.add('hidden');
            };
        }
        
        function generateCartItemId(product, options) {
            const optionsString = options.map(o => `${o.group}:${o.name}`).sort().join('|');
            return `${product.id}-${optionsString}`;
        }

        function addToCart(product, options) {
            const cartItemId = generateCartItemId(product, options);
            const existingItem = AppState.cart.find(item => item.id === cartItemId);
            
            if (existingItem) {
                existingItem.quantity++;
            } else {
                AppState.cart.push({
                    id: cartItemId,
                    productId: product.id,
                    name: product.name,
                    basePrice: product.price,
                    options: options,
                    quantity: 1,
                });
            }
            renderCart();
        }

        function updateCartItem(cartItemId, newOptions) {
            const itemIndex = AppState.cart.findIndex(item => item.id === cartItemId);
            if (itemIndex === -1) return;

            const originalItem = AppState.cart[itemIndex];
            const product = DB.products.find(p => p.id === originalItem.productId);

            const newItemId = generateCartItemId(product, newOptions);
            
            if (newItemId === cartItemId) {
                originalItem.options = newOptions;
            } else {
                const existingNewItem = AppState.cart.find(item => item.id === newItemId);
                if (existingNewItem) {
                    existingNewItem.quantity += originalItem.quantity;
                    AppState.cart.splice(itemIndex, 1);
                } else {
                    originalItem.id = newItemId;
                    originalItem.options = newOptions;
                }
            }
            
            renderCart();
        }

        function renderCart() {
            const cartItemsContainer = a('#cart-items');
            if (AppState.cart.length === 0) {
                cartItemsContainer.innerHTML = `
                    <div class="text-center text-stone-400 py-16">
                        <p>购物车是空的</p>
                        <p class="text-sm mt-1">请从左侧选择商品</p>
                    </div>`;
            } else {
                cartItemsContainer.innerHTML = AppState.cart.map(item => {
                    const optionPrice = item.options.reduce((sum, opt) => sum + opt.price, 0);
                    const finalPrice = item.basePrice + optionPrice;
                    const optionsText = item.options.map(o => o.name).join(', ');
                    
                    return `
                    <div class="flex items-start py-3 border-b" data-cart-item-id="${item.id}">
                        <div class="flex-1 pr-2">
                            <p class="font-semibold text-sm">${item.name}</p>
                            ${optionsText ? `<p class="text-xs text-stone-500">${optionsText}</p>` : ''}
                             <p class="text-sm font-mono text-amber-700 mt-1">¥ ${finalPrice.toFixed(2)}</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button class="cart-quantity-btn" data-action="decrease">-</button>
                            <span class="w-6 text-center font-medium">${item.quantity}</span>
                            <button class="cart-quantity-btn" data-action="increase">+</button>
                        </div>
                        <div class="w-16 text-right font-semibold font-mono pl-2">¥ ${(finalPrice * item.quantity).toFixed(2)}</div>
                         <button class="cart-edit-btn ml-2 text-stone-400 hover:text-amber-600">✏️</button>
                        <button class="cart-remove-btn ml-2 text-stone-400 hover:text-red-600">🗑️</button>
                    </div>
                    `;
                }).join('');
            }
            updateTotals();
            updateCheckoutButton();
        }
        
        function updateTotals() {
            const subtotal = AppState.cart.reduce((sum, item) => {
                const optionPrice = item.options.reduce((s, opt) => s + opt.price, 0);
                return sum + (item.basePrice + optionPrice) * item.quantity;
            }, 0);
            
            const discount = 0;
            const total = subtotal - discount;

            a('#subtotal').textContent = `¥ ${subtotal.toFixed(2)}`;
            a('#discount').textContent = `- ¥ ${discount.toFixed(2)}`;
            a('#total').textContent = `¥ ${total.toFixed(2)}`;
        }
        
        function updateCheckoutButton() {
            a('#checkout-btn').disabled = AppState.cart.length === 0;
        }
        
        function handleCartActions(e) {
            const target = e.target;
            const itemEl = target.closest('[data-cart-item-id]');
            if (!itemEl) return;
            const cartItemId = itemEl.dataset.cartItemId;
            const itemIndex = AppState.cart.findIndex(i => i.id === cartItemId);
            if (itemIndex === -1) return;

            if (target.matches('.cart-quantity-btn')) {
                const action = target.dataset.action;
                if (action === 'increase') {
                    AppState.cart[itemIndex].quantity++;
                } else if (action === 'decrease') {
                    AppState.cart[itemIndex].quantity--;
                    if (AppState.cart[itemIndex].quantity <= 0) {
                        AppState.cart.splice(itemIndex, 1);
                    }
                }
            } else if (target.matches('.cart-remove-btn')) {
                AppState.cart.splice(itemIndex, 1);
            } else if (target.matches('.cart-edit-btn')) {
                const cartItem = AppState.cart[itemIndex];
                const product = DB.products.find(p => p.id === cartItem.productId);
                showOptionsModal(product, cartItem);
                return;
            }
            renderCart();
        }

        function clearCart() {
            AppState.cart = [];
            renderCart();
        }
        
        function checkout() {
            if (AppState.cart.length === 0) return;
            alert(`结账总额: ${a('#total').textContent}`);
            AppState.orderIdCounter++;
            a('#order-id').textContent = `#${AppState.orderIdCounter}`;
            clearCart();
        }

        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('zh-CN', { hour12: false });
            a('#current-time').textContent = timeString;
        }

        document.addEventListener('DOMContentLoaded', () => {
            a('#order-id').textContent = `#${AppState.orderIdCounter}`;
            renderCategories();
            renderProducts();
            updateCheckoutButton();
            a('#cart-items').addEventListener('click', handleCartActions);
            a('#clear-cart-btn').addEventListener('click', clearCart);
            a('#checkout-btn').addEventListener('click', checkout);
            a('#search-bar').addEventListener('input', e => renderProducts(e.target.value));
            setInterval(updateTime, 1000);
            updateTime();
        });
    </script>

</body>
</html>
